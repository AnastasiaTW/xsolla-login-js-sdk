!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.XL=e()}}(function(){return function e(t,o,n){function r(s,a){if(!o[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var p=o[s]={exports:{}};t[s][0].call(p.exports,function(e){var o=t[s][1][e];return r(o?o:e)},p,p.exports,e,t,o,n)}return o[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,o){var n=function(e,t){var o=this;this.baseUrl=t||"//login.xsolla.com/api/",this.projectId=e,this.makeApiCall=function(e,t,n){var r=new XMLHttpRequest;r.withCredentials=!0,r.open(e.method,o.baseUrl+e.endpoint,!0),r.onreadystatechange=function(){4==r.readyState&&(200==r.status?t(JSON.parse(r.responseText)):n(r.responseText?JSON.parse(r.responseText):{error:{message:"Networking error",code:r.status}}))},"POST"==e.method?(r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(e.postBody)):"GET"==e.method&&r.send(e.getArguments)}};n.prototype.getSocialsURLs=function(e,t,o){var n="";for(var r in o)""!=n&&(n+="&"),n+=r+"="+encodeURIComponent(o[r]);return this.makeApiCall({method:"GET",endpoint:"social/login_urls?"+n,getArguments:null},e,t)},n.prototype.loginPassAuth=function(e,t,o,n,r,i){var s={username:e,password:t,remember_me:o};return this.makeApiCall({method:"POST",endpoint:"proxy/login?projectId="+this.projectId+"&redirect_url="+encodeURIComponent(n),postBody:JSON.stringify(s)},r,i)},n.prototype.smsAuth=function(e,t,o){return this.makeApiCall({method:"GET",endpoint:"sms",getArguments:"phoneNumber="+e},t,o)},t.exports=n},{}],main:[function(e,t,o){function n(e){function t(e){if(e.attributes["data-xl-auth"])return e;for(var t=0;(e=e.parentElement)&&!e.attributes["data-xl-auth"]&&++t<o._options.maxXLClickDepth;);return e}var o=this;o._socialUrls={},o._options={},o._options.errorHandler=e.errorHandler||function(e){},o._options.loginPassValidator=e.loginPassValidator||function(e,t){return!0},o._options.isMarkupSocialsHandlersEnabled=e.isMarkupSocialsHandlersEnabled||!1,o._options.redirectUrl=e.redirectUrl||void 0,o._options.apiUrl=e.apiUrl||"//login.xsolla.com/api/",o._options.maxXLClickDepth=e.maxXLClickDepth||20,o._options.onlyWidgets=e.onlyWidgets||!1,o._options.projectId=e.projectId;var n={};if(n.projectId=e.projectId,o._options.redirectUrl&&(n.redirect_url=o._options.redirectUrl),o._api=new r(e.projectId,o._options.apiUrl),!o._options.onlyWidgets){var i=function(){o._api.getSocialsURLs(function(e){o._socialUrls={};for(var t in e)e.hasOwnProperty(t)&&(o._socialUrls["sn-"+t]=e[t])},function(e){console.error(e)},n)};i(),setInterval(i,354e4);{o.getAllElementsWithAttribute("data-xl-auth")}o._options.isMarkupSocialsHandlersEnabled&&document.addEventListener("click",function(e){var n=t(e.target);if(n){var r=n.attributes["data-xl-auth"];if(r){var i=r.nodeValue;i&&o.login({authType:i})}}})}}var r=e("./xlapi");n.prototype.login=function(e,t,o){var r=this;if(e&&r._socialUrls&&e.authType)if(e.authType.startsWith("sn-")){var i=r._socialUrls[e.authType];void 0!=i?window.location.href=r._socialUrls[e.authType]:console.error("Auth type: "+e.authType+" doesn't exist")}else"login-pass"==e.authType?r._api.loginPassAuth(e.login,e.pass,e.rememberMe,r._options.redirectUrl,function(e){if(e.login_url){var i=function(){window.location.href=e.login_url};o?o({status:"success",finish:i,redirectUrl:e.login_url}):i()}else t(r.createErrorObject("Login or pass not valid",n.INCORRECT_LOGIN_OR_PASSWORD_ERROR_CODE))},function(e){t(e)}):"sms"==e.authType?"phone"==smsAuthStep?r._api.smsAuth(e.phoneNumber,null,null):"code"==smsAuthStep:console.error("Unknown auth type")},n.prototype.sendSms=function(e,t,o){},n.prototype.getAllElementsWithAttribute=function(e){for(var t=[],o=document.getElementsByTagName("*"),n=0,r=o.length;r>n;n++)null!==o[n].getAttribute(e)&&t.push(o[n]);return t},n.prototype.createErrorObject=function(e,t){return{error:{message:e,code:t||-1}}},n.getProjectId=function(){return window.__xl._options.projectId},n.getRedirectURL=function(){return window.__xl._options.redirectUrl},n.getOptions=function(){return window.__xl._options},n.init=function(e){if(window.__xl)console.error("XL already init!");else{var t=new n(e);window.__xl=t}},n.login=function(e,t,o){window.__xl?window.__xl.login(e,t,o):console.error("Please run XL.init() first")},n.AuthWidget=function(e,t){if(window.__xl)if(e){void 0==t&&(t={});var o=t.width||200,r=t.height||400,i="http://localhost:8080/home/?projectId="+n.getProjectId(),s=n.getRedirectURL();s&&(i=i+"&redirectUrl="+encodeURIComponent(s));var a=document.createElement("iframe");a.onload=function(){u.removeChild(l),a.style.width=o+"px",a.style.height=r+"px"},a.style.width=0,a.style.height=0,a.frameBorder="0",a.src=i;var l=document.createElement("div");l.innerHTML="Loading...";var u=document.getElementById(e);u?(u.appendChild(l),u.appendChild(a)):console.error('Element "'+e+'" not found!')}else console.error("No div name!");else console.error("Please run XL.init() first")},n.AuthButton=function(e,t){},n.INVALID_LOGIN_ERROR_CODE=1,n.INCORRECT_LOGIN_OR_PASSWORD_ERROR_CODE=2,t.exports=n},{"./xlapi":1}]},{},["main"])("main")});
//# sourceMappingURL=xl.min.js.map