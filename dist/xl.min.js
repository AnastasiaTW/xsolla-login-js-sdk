!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.XL=e()}}(function(){return function e(t,n,o){function r(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var p=n[s]={exports:{}};t[s][0].call(p.exports,function(e){var n=t[s][1][e];return r(n?n:e)},p,p.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){var o=function(e){var t=this;this.baseUrl="http://xsolla-login-api.herokuapp.com/api/",this.projectId=e,this.makeApiCall=function(e,n,o){var r=new XMLHttpRequest;r.open(e.method,t.baseUrl+e.endpoint,!0),r.onreadystatechange=function(){4==r.readyState&&(200==r.status?n(JSON.parse(r.responseText)):o(JSON.parse(r.responseText)))},r.send(e.getArguments)}};o.prototype.getSocialsURLs=function(e,t){return this.makeApiCall({method:"GET",endpoint:"social/login_urls?projectId="+this.projectId,getArguments:null},e,t)},o.prototype.loginPassAuth=function(e,t,n,o){var r={username:e,password:t};return this.makeApiCall({method:"POST",endpoint:"proxy/login?projectId="+this.projectId,getArguments:JSON.stringify(r)},n,o)},o.prototype.smsAuth=function(e,t,n){return this.makeApiCall({method:"GET",endpoint:"sms",getArguments:"phoneNumber="+e},t,n)},t.exports=o},{}],main:[function(e,t,n){function o(e){var t=this;if(!(this instanceof o))return new o(e);if(t._socialUrls={},t._errorHandler=e.errorHandler,t._api=new r(e.projectId),t._api.getSocialsURLs(function(e){for(key in e)t._socialUrls["sn-"+key]=e[key];console.log(t._socialUrls)},function(e){console.error(e)}),1==e.addHandlers)for(var n=t.getAllElementsWithAttribute("data-xl-auth"),i="",s="",a=0;a<n.length;a++){var u=n[a].attributes["data-xl-auth"].nodeValue;u.startsWith("sn")?n[a].onclick=function(e){return function(){t.login({authType:e})}}(u):"form-sms"==u||("form-login_pass"==u?n[a].onsubmit=function(e,n){return function(o){o.preventDefault(),t.login({authType:"login-pass",login:e,pass:n},function(e){e.error?t._errorHandler&&t._errorHandler(e.error):window.location.href=""})}}(i,s):u.startsWith("input-")&&("input-login"==u?i="":"input-pass"==u&&(s="")))}}var r=e("./xlapi");o.prototype.login=function(e,t){var n=this;if(e&&n._socialUrls&&e.authType)if(e.authType.startsWith("sn-")){var o=n._socialUrls[e.authType];void 0!=o?window.location.href=n._socialUrls[e.authType]:console.error("Auth type: "+e.authType+" doesn't exist")}else"login-pass"==e.authType?n._api.loginPassAuth(e.login,e.pass,t,t):"sms"==e.authType?"phone"==smsAuthStep?n._api.smsAuth(e.phoneNumber,null,null):"code"==smsAuthStep:console.error("Unknown auth type")},o.prototype.getAllElementsWithAttribute=function(e){for(var t=[],n=document.getElementsByTagName("*"),o=0,r=n.length;r>o;o++)null!==n[o].getAttribute(e)&&t.push(n[o]);return t},t.exports=o},{"./xlapi":1}]},{},["main"])("main")});
//# sourceMappingURL=xl.min.js.map