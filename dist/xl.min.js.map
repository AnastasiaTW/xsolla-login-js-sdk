{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/xlapi.js","xl.min.js","src/main.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","XL","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length",1,"XLApi","projectId","baseUrl","makeApiCall","params","success","error","console","log","XMLHttpRequest","open","method","endpoint","onreadystatechange","readyState","status","JSON","parse","responseText","message","send","getArguments","prototype","getSocialsURLs","loginPassAuth","login","pass","body","username","password","stringify","smsAuth","phoneNumber","main","options","_socialUrls","undefined","_options","errorHandler","loginPassValidator","b","_api","response","key","hasOwnProperty","elements","getAllElementsWithAttribute","nodeValue","attributes","startsWith","onclick","authType","onsubmit","preventDefault","res","createErrorObject","INVALID_LOGIN_ERROR_CODE","prop","callback","socialUrl","location","href","login_url","INCORRECT_LOGIN_OR_PASSWORD_ERROR_CODE","err","smsAuthStep","attribute","matchingElements","allElements","document","getElementsByTagName","getAttribute","push","./xlapi"],"mappings":"CAAA,SAAAA,GAAA,GAAA,gBAAAC,UAAA,mBAAAC,QAAAA,OAAAD,QAAAD,QAAA,IAAA,kBAAAG,SAAAA,OAAAC,IAAAD,UAAAH,OAAA,CAAA,GAAAK,EAAAA,GAAA,mBAAAC,QAAAA,OAAA,mBAAAC,QAAAA,OAAA,mBAAAC,MAAAA,KAAAC,KAAAJ,EAAAK,GAAAV,MAAA,WAAA,MAAA,SAAAW,GAAAC,EAAAC,EAAAC,GAAA,QAAAC,GAAAC,EAAAC,GAAA,IAAAJ,EAAAG,GAAA,CAAA,IAAAJ,EAAAI,GAAA,CAAA,GAAAE,GAAA,kBAAAC,UAAAA,OAAA,KAAAF,GAAAC,EAAA,MAAAA,GAAAF,GAAA,EAAA,IAAAI,EAAA,MAAAA,GAAAJ,GAAA,EAAA,IAAAhB,GAAA,GAAAqB,OAAA,uBAAAL,EAAA,IAAA,MAAAhB,GAAAsB,KAAA,mBAAAtB,EAAA,GAAAuB,GAAAV,EAAAG,IAAAf,WAAAW,GAAAI,GAAA,GAAAQ,KAAAD,EAAAtB,QAAA,SAAAU,GAAA,GAAAE,GAAAD,EAAAI,GAAA,GAAAL,EAAA,OAAAI,GAAAF,EAAAA,EAAAF,IAAAY,EAAAA,EAAAtB,QAAAU,EAAAC,EAAAC,EAAAC,GAAA,MAAAD,GAAAG,GAAAf,QAAA,IAAA,GAAAmB,GAAA,kBAAAD,UAAAA,QAAAH,EAAA,EAAAA,EAAAF,EAAAW,OAAAT,IAAAD,EAAAD,EAAAE,GAAA,OAAAD,KAAAW,GAAA,SAAAP,EAAAjB,EAAAD,GCQA,GAAA0B,GAAA,SAAAC,GACA,GAAApB,GAAAC,IAEAA,MAAAoB,QAAA,oCACApB,KAAAmB,UAAAA,EAEAnB,KAAAqB,YAAA,SAAAC,EAAAC,EAAAC,GAEAC,QAAAC,IAAA,SAEA,IAAArB,GAAA,GAAAsB,eACAtB,GAAAuB,KAAAN,EAAAO,OAAA9B,EAAAqB,QAAAE,EAAAQ,UAAA,GACAzB,EAAA0B,mBAAA,WACA,GAAA1B,EAAA2B,aACA,KAAA3B,EAAA4B,OACAV,EAAAW,KAAAC,MAAA9B,EAAA+B,eAGAZ,EADAnB,EAAA+B,aACAF,KAAAC,MAAA9B,EAAA+B,eAEAZ,OAAAa,QAAA,wBAKAhC,EAAAiC,KAAAhB,EAAAiB,eAQArB,GAAAsB,UAAAC,eAAA,SAAAlB,EAAAC,GACA,MAAAxB,MAAAqB,aAAAQ,OAAA,MAAAC,SAAA,+BAAA9B,KAAAmB,UAAAoB,aAAA,MAAAhB,EAAAC,IAGAN,EAAAsB,UAAAE,cAAA,SAAAC,EAAAC,EAAArB,EAAAC,GACA,GAAAqB,IACAC,SAAAH,EACAI,SAAAH,EAEA,OAAA5C,MAAAqB,aAAAQ,OAAA,OAAAC,SAAA,yBAAA9B,KAAAmB,UAAAoB,aAAAL,KAAAc,UAAAH,IAAAtB,EAAAC,IAGAN,EAAAsB,UAAAS,QAAA,SAAAC,EAAA3B,EAAAC,GACA,MAAAxB,MAAAqB,aAAAQ,OAAA,MAAAC,SAAA,MAAAS,aAAA,eAAAW,GAAA3B,EAAAC,IAGA/B,EAAAD,QAAA0B,OCGMiC,MAAQ,SAASzC,EAAQjB,EAAOD,GCjDtC,QAAAS,GAAAmD,GACA,GAAArD,GAAAC,IAEAD,GAAAsD,YAAAC,OAEAvD,EAAAwD,YACAxD,EAAAwD,SAAAC,aAAAJ,EAAAI,cAAA,SAAA/C,KACAV,EAAAwD,SAAAE,mBAAAL,EAAAK,oBAAA,SAAAhD,EAAAiD,GAAA,OAAA,GAEA3D,EAAA4D,KAAA,GAAAzC,GAAAkC,EAAAjC,WACApB,EAAA4D,KAAAlB,eAAA,SAAAmB,GACA7D,EAAAsD,cACA,KAAA,GAAAQ,KAAAD,GACAA,EAAAE,eAAAD,KACA9D,EAAAsD,YAAA,MAAAQ,GAAAD,EAAAC,KAGA,SAAA3D,GACAuB,QAAAD,MAAAtB,IAOA,KAAA,GAJA6D,GAAAhE,EAAAiE,4BAAA,gBACArB,EAAA,GACAC,EAAA,GAEAjC,EAAA,EAAAA,EAAAoD,EAAA/C,OAAAL,IAAA,CACA,GAAAsD,GAAAF,EAAApD,GAAAuD,WAAA,gBAAAD,SACAA,GAAAE,WAAA,MACAJ,EAAApD,GAAAyD,QAAA,SAAAH,GACA,MAAA,YACAlE,EAAA4C,OAAA0B,SAAAJ,MAEAA,GACA,YAAAA,IAEA,mBAAAA,EAEAF,EAAApD,GAAA2D,SAAA,SAAA3B,EAAAC,GACA,MAAA,UAAA1C,GACAA,EAAAqE,iBACAxE,EAAAwD,SAAAE,mBAAAd,EAAAC,GACA7C,EAAA4C,OACA0B,SAAA,aACA1B,MAAAA,EACAC,KAAAA,GACA,SAAA4B,GACAA,EAAAhD,OACAzB,EAAAwD,SAAAC,aAAAgB,KAIAzE,EAAAwD,SAAAC,aAAAzD,EAAA0E,kBAAA,0BAAAxE,EAAAyE,6BAGA/B,EAAAC,GACAqB,EAAAE,WAAA,YACA,eAAAF,EACAtB,EAAA,GACA,cAAAsB,IACArB,EAAA,OAlEA,GAAA1B,GAAAR,EAAA,UAwEAT,GAAAuC,UAAAG,MAAA,SAAAgC,EAAAC,GACA,GAAA7E,GAAAC,IAEA,IAAA2E,GAAA5E,EAAAsD,aAQAsB,EAAAN,SACA,GAAAM,EAAAN,SAAAF,WAAA,OAAA,CACA,GAAAU,GAAA9E,EAAAsD,YAAAsB,EAAAN,SACAf,SAAAuB,EACAhF,OAAAiF,SAAAC,KAAAhF,EAAAsD,YAAAsB,EAAAN,UAEA5C,QAAAD,MAAA,cAAAmD,EAAAN,SAAA,sBAGA,cAAAM,EAAAN,SACAtE,EAAA4D,KAAAjB,cAAAiC,EAAAhC,MAAAgC,EAAA/B,KAAA,SAAAnC,GACA+D,IAAAQ,UACAnF,OAAAiF,SAAAC,KAAAP,IAAAQ,UAEAJ,EAAA7E,EAAA0E,kBAAA,0BAAAxE,EAAAgF,0CAEA,SAAAC,GACAN,EAAAM,KAEA,OAAAP,EAAAN,SACA,SAAAc,YACApF,EAAA4D,KAAAV,QAAA0B,EAAAzB,YAAA,KAAA,MACA,QAAAiC,YAKA1D,QAAAD,MAAA,sBAMAvB,EAAAuC,UAAAwB,4BAAA,SAAAoB,GAGA,IAAA,GAFAC,MACAC,EAAAC,SAAAC,qBAAA,KACA7E,EAAA,EAAAP,EAAAkF,EAAAtE,OAAAZ,EAAAO,EAAAA,IAEA,OAAA2E,EAAA3E,GAAA8E,aAAAL,IAEAC,EAAAK,KAAAJ,EAAA3E,GAGA,OAAA0E,IAGApF,EAAAuC,UAAAiC,kBAAA,SAAApC,EAAAxB,GACA,OACAW,OACAa,QAAAA,EACAxB,KAAAA,GAAA,MAKAZ,EAAAyE,yBAAA,EACAzE,EAAAgF,uCAAA,EAEAxF,EAAAD,QAAAS,ID8DG0F,UAAU,SAAS,SAAS","file":"xl.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n * Created by a.korotaev on 24.06.16.\n */\n/**\n * Impelements Xsolla Login Api\n * @param projectId - project's unique identifier\n * @constructor\n */\nvar XLApi = function (projectId) {\n    var self = this;\n    // this.baseUrl = 'http://xsolla-login-api.herokuapp.com/api/'; //http://test-login.xsolla.com/api/\n    this.baseUrl = 'http://test-login.xsolla.com/api/';\n    this.projectId = projectId;\n\n    this.makeApiCall = function (params, success, error) {\n\n        console.log('asdasd');\n\n        var r = new XMLHttpRequest();\n        r.open(params.method, self.baseUrl + params.endpoint, true);\n        r.onreadystatechange = function () {\n            if (r.readyState == 4) {\n                if (r.status == 200) {\n                    success(JSON.parse(r.responseText));\n                } else {\n                    if (r.responseText) {\n                        error(JSON.parse(r.responseText));\n                    } else {\n                        error({error: {message: 'Networking error'}});\n                    }\n                }\n            }\n        };\n        r.send(params.getArguments);\n    };\n};\n/**\n * Get all avialable social methods auth url\n * @param success - success callback\n * @param error - error callback\n */\nXLApi.prototype.getSocialsURLs = function (success, error) {\n    return this.makeApiCall({method: 'GET', endpoint: 'social/login_urls?projectId='+this.projectId, getArguments: null}, success, error);\n};\n\nXLApi.prototype.loginPassAuth = function (login, pass, success, error) {\n    var body = {\n        username: login,\n        password: pass\n    };\n    return this.makeApiCall({method: 'POST', endpoint: 'proxy/login?projectId='+this.projectId, getArguments: JSON.stringify(body)}, success, error);\n};\n\nXLApi.prototype.smsAuth = function (phoneNumber, success, error) {\n    return this.makeApiCall({method: 'GET', endpoint: 'sms', getArguments: 'phoneNumber=' + phoneNumber}, success, error);\n};\n\nmodule.exports = XLApi;\n",null,"/**\n * Created by a.korotaev on 24.06.16.\n */\n\nvar XLApi = require('./xlapi');\n/**\n * Create an `Auth0` instance with `options`\n *\n * @class XL\n * @constructor\n */\nfunction XL (options) {\n    var self = this;\n\n    self._socialUrls = undefined;\n\n    self._options = {};\n    self._options.errorHandler = options.errorHandler || function(a) {};\n    self._options.loginPassValidator = options.loginPassValidator || function (a,b) { return true; };\n\n    self._api = new XLApi(options.projectId);\n    self._api.getSocialsURLs(function (response) {\n        self._socialUrls = {};\n        for (var key in response) {\n            if (response.hasOwnProperty(key)) {\n                self._socialUrls['sn-' + key] = response[key];\n            }\n        }\n    }, function (e) {\n        console.error(e);\n    });\n\n    var elements = self.getAllElementsWithAttribute('data-xl-auth');\n    var login = '';\n    var pass = '';\n\n    for (var i = 0; i < elements.length; i++) {\n        var nodeValue = elements[i].attributes['data-xl-auth'].nodeValue;\n        if (nodeValue.startsWith('sn')) {\n            elements[i].onclick = function (nodeValue) {\n                return function () {\n                    self.login({authType: nodeValue})\n                };\n            }(nodeValue);\n        } else if (nodeValue == 'form-sms') {\n            // elements[i].onsubmit = config.eventHandlers.sms;\n        } else if (nodeValue == 'form-login_pass') {\n            // elements[i].onsubmit = config.eventHandlers.loginPass;\n            elements[i].onsubmit = function (login, pass) {\n                return function (e) {\n                    e.preventDefault();\n                    if (self._options.loginPassValidator(login, pass)) {\n                        self.login({\n                            authType: 'login-pass',\n                            login: login,\n                            pass: pass\n                        }, function (res) {\n                            if (res.error) {\n                                self._options.errorHandler(res);\n                            }\n                        });\n                    } else {\n                        self._options.errorHandler(self.createErrorObject('Login or pass not valid', XL.INVALID_LOGIN_ERROR_CODE));\n                    }\n                }\n            }(login, pass);\n        } else if (nodeValue.startsWith('input-')) {\n            if (nodeValue == 'input-login') {\n                login = '';\n            } else if (nodeValue == 'input-pass') {\n                pass = '';\n            }\n        }\n    }\n}\n\nXL.prototype.login = function (prop, callback) {\n    var self = this;\n\n    if (!prop || !self._socialUrls) {\n        return;\n    }\n\n    /**\n     * props\n     * authType: sn-<social name>, login-pass, sms\n     */\n    if (prop.authType) {\n        if (prop.authType.startsWith('sn-')) {\n            var socialUrl = self._socialUrls[prop.authType];\n            if (socialUrl != undefined) {\n                window.location.href = self._socialUrls[prop.authType];\n            } else {\n                console.error('Auth type: ' + prop.authType + ' doesn\\'t exist');\n            }\n\n        } else if (prop.authType == 'login-pass') {\n            self._api.loginPassAuth(prop.login, prop.pass, function (a) {\n                if (res.login_url) {\n                    window.location.href = res.login_url;\n                } else {\n                    callback(self.createErrorObject('Login or pass not valid', XL.INCORRECT_LOGIN_OR_PASSWORD_ERROR_CODE));\n                }\n            }, function (err) {\n                callback(err);\n            });\n        } else if (prop.authType == 'sms') {\n            if (smsAuthStep == 'phone') {\n                self._api.smsAuth(prop.phoneNumber, null, null);\n            } else if (smsAuthStep == 'code') {\n\n            }\n\n        } else {\n            console.error('Unknown auth type');\n        }\n    }\n};\n\n\nXL.prototype.getAllElementsWithAttribute = function (attribute) {\n    var matchingElements = [];\n    var allElements = document.getElementsByTagName('*');\n    for (var i = 0, n = allElements.length; i < n; i++)\n    {\n        if (allElements[i].getAttribute(attribute) !== null)\n        {\n            matchingElements.push(allElements[i]);\n        }\n    }\n    return matchingElements;\n};\n\nXL.prototype.createErrorObject = function(message, code) {\n    return {\n        error: {\n            message: message,\n            code: code || -1\n        }\n    };\n};\n\nXL.INVALID_LOGIN_ERROR_CODE = 1;\nXL.INCORRECT_LOGIN_OR_PASSWORD_ERROR_CODE = 2;\n\nmodule.exports = XL;"],"sourceRoot":"."}